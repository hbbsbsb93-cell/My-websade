<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xaqiiji Kaydinta | New Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn-gradient {
            background: linear-gradient(90deg, #13ec5b 0%, #0fb847 100%);
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #13ec5b;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-[#0f172a] min-h-screen flex items-center justify-center p-4 font-sans">

    <div class="w-full max-w-md bg-[#1e293b] rounded-3xl shadow-2xl p-8 border border-gray-700">
        <div class="flex justify-center mb-6">
            <div class="bg-green-500/10 p-4 rounded-full">
                <svg class="w-10 h-10 text-[#13ec5b]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04M12 21.355r-1.158-8.412a1.35 1.35 0 00-1.272-1.272l-8.412-1.158m1.158 8.412a1.35 1.35 0 001.272 1.272l8.412 1.158"></path>
                </svg>
            </div>
        </div>

        <h2 class="text-white text-2xl font-extrabold text-center mb-2">Tallaabada u dambaysa</h2>
        <p class="text-gray-400 text-center text-sm mb-8 px-4">
            Si aan password-kaaga u beddelno, waxaan Gmail-kaaga u soo diraynaa link ammaan ah oo Google ka socda.
        </p>

        <button id="reset-btn" class="w-full btn-gradient text-black font-bold py-4 rounded-2xl shadow-lg shadow-green-500/20 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
            <span id="btn-text">U dir Gmail Reset Link</span>
            <div id="loader" class="loader hidden"></div>
        </button>

        <div id="status-msg" class="mt-6 text-sm text-center hidden"></div>

        <div class="mt-8 pt-6 border-t border-gray-700">
            <p class="text-gray-500 text-xs text-center">
                Maadaama aan u diyaarinayno <b>Shaqo Production ah</b>, habkan ayaa ah kan ugu ammaan badan ee Google ay aqbasho.
            </p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // Geli xogtaada Firebase Config-ka ah halkan
        const firebaseConfig = {
            apiKey: "AIzaSy...", 
            authDomain: "my-websade.firebaseapp.com",
            projectId: "my-websade"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const resetBtn = document.getElementById('reset-btn');
        const loader = document.getElementById('loader');
        const btnText = document.getElementById('btn-text');
        const statusMsg = document.getElementById('status-msg');

        resetBtn.addEventListener('click', async () => {
            const email = sessionStorage.getItem('resetEmail');

            if (!email) {
                alert("Session-ku waa dhacay. Fadlan dib u bilow email-ka.");
                window.location.href = "email.html";
                return;
            }

            // UI Feedback
            resetBtn.disabled = true;
            loader.classList.remove('hidden');
            btnText.innerText = "Waa la dirayaa...";

            try {
                // Tani waa "Waddada 2-aad" oo bilaash ah oo card-ka u baahnayn
                await sendPasswordResetEmail(auth, email);
                
                statusMsg.innerHTML = `<span class="text-green-400 font-medium">✅ Link-ga waa la soo diray! Hubi Gmail-kaaga.</span>`;
                statusMsg.classList.remove('hidden');
                
                setTimeout(() => {
                    alert("Google waxay kuu soo dirtay email. Riix link-gaas si aad password-ka u beddelato.");
                    window.location.href = "login.html";
                }, 2000);

            } catch (error) {
                resetBtn.disabled = false;
                loader.classList.add('hidden');
                btnText.innerText = "U dir Gmail Reset Link";
                
                statusMsg.innerHTML = `<span class="text-red-400">❌ Cilad: ${error.message}</span>`;
                statusMsg.classList.remove('hidden');
            }
        });
        
        // 1. Hubi in qofku uu soo maray nidaamka (OTP Verification)
const isVerified = sessionStorage.getItem('isVerified'); // Tani waa in lagu dhex daro intetcode.html markuu OTP saxo
const userEmail = sessionStorage.getItem('resetEmail');

if (!isVerified || !userEmail) {
    // Haddii uusan soo xaqiijin OTP-ga, dib ugu celi bilowga
    window.location.href = "email.html";
}

    </script>
</body>
</html>
