<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Register - Nature's Glow Skincare</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
          darkMode: "class",
          theme: {
            extend: {
              colors: {
                "primary": "#13ec5b",
                "background-light": "#fcf9f2",
                "background-dark": "#102216",
              },
              fontFamily: { "display": ["Manrope", "sans-serif"] },
            },
          },
        }
    </script>
    <style>
        .spinner {
            width: 45px; height: 45px;
            border: 5px solid #e5e7eb;
            border-top: 5px solid #13ec5b;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display p-6 relative">

    <div class="max-w-md w-full z-10 mx-auto">
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-primary/20 rounded-full mb-4">
                <span class="material-icons text-primary text-3xl">spa</span>
            </div>
            <h1 class="text-3xl font-extrabold text-background-dark dark:text-white mb-2 tracking-tight">Nature's Glow</h1>
            <p class="text-zinc-600 dark:text-zinc-400 font-medium">Join our community.</p>
        </div>

        <div class="bg-white dark:bg-zinc-900 shadow-xl rounded-xl p-8 border border-zinc-100 dark:border-zinc-800">
            <form id="register-form" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-1.5">Full Name</label>
                    <div class="relative">
                        <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 text-lg">person_outline</span>
                        <input class="w-full pl-10 pr-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-900 dark:text-white" id="full-name" placeholder="John Doe" type="text" required/>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-1.5">Email Address</label>
                    <div class="relative">
                        <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 text-lg">mail_outline</span>
                        <input class="w-full pl-10 pr-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-900 dark:text-white" id="email" placeholder="your email" type="email" required/>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-1.5">Password</label>
                    <div class="relative">
                        <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 text-lg">lock_outline</span>
                        <input class="w-full pl-10 pr-10 py-3 bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-900 dark:text-white" id="password" placeholder="••••••••" type="password" required/>
                        <button id="togglePassword" class="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600" type="button">
                            <span class="material-icons text-lg">visibility_off</span>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-1.5">Confirm Password</label>
                    <div class="relative">
                        <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 text-lg">verified_user</span>
                        <input class="w-full pl-10 pr-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-900 dark:text-white" id="confirm-password" placeholder="••••••••" type="password" required/>
                    </div>
                </div>
                <button class="w-full bg-primary hover:bg-opacity-90 text-background-dark font-bold py-4 px-4 rounded-lg shadow-lg flex items-center justify-center gap-2 group" type="submit">
                    Sign Up
                    <span class="material-icons group-hover:translate-x-1 transition-transform">arrow_forward</span>
                </button>
            </form>
        </div>
    </div>

    <div id="loader" class="fixed inset-0 bg-white/60 dark:bg-zinc-900/60 z-[500] hidden flex flex-col items-center justify-center backdrop-blur-sm">
        <div class="spinner"></div>
        <p class="mt-4 text-background-dark dark:text-white font-bold animate-pulse">Checking credentials...</p>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <script type="text/javascript">
        // Isticmaal Public Key-gaaga sawirka ku jiray
        emailjs.init("IN3zER21TXypQH8rt");
    </script>

    <script type="module">
        // 1. Show/Hide Password Logic
        const togglePassword = document.querySelector('#togglePassword');
        const passwordInput = document.querySelector('#password');

        togglePassword.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.querySelector('span').innerText = type === 'password' ? 'visibility_off' : 'visibility';
        });

        // 2. Form Submission & EmailJS
        const registerForm = document.getElementById('register-form');
        const loader = document.getElementById('loader');
        const loaderText = loader ? loader.querySelector('p') : null;

        if (registerForm) {
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPass = document.getElementById('confirm-password').value;

                if (password !== confirmPass) {
                    alert("⚠️ Password-yadu isma laha!");
                    return;
                }

                if (loader) {
                    loader.classList.remove('hidden');
                    if (loaderText) loaderText.innerText = "Koodhkii xaqiijinta ayaa loo dirayaa email-kaaga...";
                }

                const otpCode = Math.floor(100000 + Math.random() * 900000).toString();

                sessionStorage.setItem('generatedOTP', otpCode);
                sessionStorage.setItem('pendingEmail', email);

                const templateParams = {
                    email: email,       
                    passcode: otpCode   
                };

                emailjs.send('service_twqprpi', 'template_dlpkvxw', templateParams)
                    .then(function() {
                        if (loaderText) loaderText.innerText = "Guul! Koodhkii waa la diray...";
                        setTimeout(() => {
                            window.location.href = "Ver.html"; 
                        }, 1200); 
                    })
                    .catch(function(error) {
                        if (loader) loader.classList.add('hidden'); 
                        alert("Cillad: " + JSON.stringify(error));
                    });
            });
        }
    </script>
</body>
</html>
