<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enter Code | Verify</title>
<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: "#13ec5b"
      }
    }
  }
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Manrope', sans-serif; }
.code-input {
  aspect-ratio: 1 / 1;
  width: 100%;
  text-align: center;
  font-size: clamp(18px, 4vw, 24px);
  font-weight: 600;
}
</style>
</head>

<body class="min-h-screen flex items-center justify-center bg-gray-100 p-4">

<div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-6 sm:p-8">
  <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Enter Code</h1>
  <p class="text-gray-500 mb-6 text-sm sm:text-base">Please enter the 5-digit code sent to your email.</p>

  <form id="code-form" class="space-y-6">
    <div class="grid grid-cols-5 gap-3 sm:gap-4">
      <input type="text" maxlength="1" id="code-1" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" maxlength="1" id="code-2" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" maxlength="1" id="code-3" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" maxlength="1" id="code-4" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" maxlength="1" id="code-5" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
    </div>

    <button type="submit" id="verify-code-btn" class="w-full bg-primary hover:opacity-90 text-black font-semibold py-3 sm:py-4 rounded-xl transition shadow-lg">
      Verify Code
    </button>
  </form>
</div>

<div id="loader" class="fixed inset-0 bg-black/50 hidden z-[100] flex items-center justify-center">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-primary"></div>
</div>

<script>
    const inputs = document.querySelectorAll(".code-input");
    const loader = document.getElementById('loader');
    const codeForm = document.getElementById('code-form');

    // 1. Shaqada Gudubka Inputs-ka (Auto-focus)
    inputs.forEach((input, index) => {
        input.addEventListener("input", (e) => {
            if (e.inputType === "deleteContentBackward") return; // Haddii la tirtirayo ha gudbin
            if (input.value.length === 1 && index < inputs.length - 1) {
                inputs[index + 1].focus();
            }
        });

        input.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" && input.value === "" && index > 0) {
                inputs[index - 1].focus();
            }
        });
    });

    // 2. Shaqada Hubinta Koodhka (Submit Logic)
    codeForm.addEventListener('submit', (e) => {
        e.preventDefault();
        loader.classList.remove('hidden');

        try {
            // Isku dar 5-ta xaraf ee sanduuqyada
            let enteredOTP = "";
            inputs.forEach(input => enteredOTP += input.value);

            // Soo qaado koodhkii email-ka loogu diray ee sessionStorage ku jiray
            const correctOTP = sessionStorage.getItem('generatedOTP');

            if (!correctOTP) {
                throw new Error("Fadhigii wuu dhacay (Session expired). Fadlan dib u codso koodhka.");
            }

            if (enteredOTP === correctOTP) {
                // Haddii uu sax yahay, u weeci bogga baddalka password-ka
                setTimeout(() => {
                    window.location.href = "forget.html";
                }, 800);
            } else {
                throw new Error("Koodhkaagu waa khalad! Fadlan mar kale iska hubi.");
            }
        } catch (error) {
            loader.classList.add('hidden');
            alert("‚ùå " + error.message);
        }
    });
</script>

</body>
</html>
