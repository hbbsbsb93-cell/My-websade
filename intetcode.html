<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enter Code | Verify</title>
<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: "#13ec5b"
      }
    }
  }
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Manrope', sans-serif; }
.code-input {
  aspect-ratio: 1 / 1;
  width: 100%;
  text-align: center;
  font-size: clamp(18px, 4vw, 24px);
  font-weight: 600;
}
/* Haddii koodhku khaldamo */
.border-error {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1);
}
</style>
</head>

<body class="min-h-screen flex items-center justify-center bg-gray-100 p-4">

<div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-6 sm:p-8">
  <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Enter Code</h1>
  <p class="text-gray-500 mb-6 text-sm sm:text-base">Please enter the 5-digit code sent to your email.</p>

  <form id="code-form" class="space-y-6">
    <div class="grid grid-cols-5 gap-3 sm:gap-4">
      <input type="text" inputmode="numeric" maxlength="1" id="code-1" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" inputmode="numeric" maxlength="1" id="code-2" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" inputmode="numeric" maxlength="1" id="code-3" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" inputmode="numeric" maxlength="1" id="code-4" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
      <input type="text" inputmode="numeric" maxlength="1" id="code-5" class="code-input rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition" required />
    </div>

    <button type="submit" id="verify-code-btn" class="w-full bg-primary hover:opacity-90 text-black font-semibold py-3 sm:py-4 rounded-xl transition shadow-lg">
      Verify Code
    </button>
  </form>
</div>

<div id="loader" class="fixed inset-0 bg-black/50 hidden z-[100] flex items-center justify-center">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-primary"></div>
</div>

<script>
    const inputs = document.querySelectorAll(".code-input");
    const loader = document.getElementById('loader');
    const codeForm = document.getElementById('code-form');

    // 1. Hubi in Session-ku jiro (Inaan qofku boggan soo dhex dhicin isagoo soo marin email.html)
    window.onload = () => {
        if (!sessionStorage.getItem('generatedOTP')) {
            alert("⚠️ Session-kaagu wuu dhacay. Fadlan dib u bilow.");
            window.location.href = "email.html"; 
        }
    };

    // 2. Auto-focus Logic: U gudub sanduuqa xiga markaad qorto
    inputs.forEach((input, index) => {
        input.addEventListener("input", (e) => {
            input.classList.remove('border-error');
            if (e.inputType === "deleteContentBackward") return;
            if (input.value.length === 1 && index < inputs.length - 1) {
                inputs[index + 1].focus();
            }
        });

        input.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" && input.value === "" && index > 0) {
                inputs[index - 1].focus();
            }
        });
    });

    // 3. Hubinta Koodhka (OTP Verification)
    codeForm.addEventListener('submit', (e) => {
        e.preventDefault();
        loader.classList.remove('hidden');

        let enteredOTP = "";
        inputs.forEach(input => enteredOTP += input.value);

        // Koodhkii email-ka loogu diray ee sessionStorage ku kaydsanaa
        const correctOTP = sessionStorage.getItem('generatedOTP');

        // Wax yar sug si uu loader-ku u muuqdo
        setTimeout(() => {
            if (enteredOTP === correctOTP) {
                // HADDII UU SAX YAHAY: U gudbi bogga Firebase ee Newpass.html
                window.location.href = "Newpass.html";
            } else {
                // HADDII UU KHALAD YAHAY
                loader.classList.add('hidden');
                inputs.forEach(input => input.classList.add('border-error'));
                alert("❌ Koodhkaagu waa khalad! Fadlan iska hubi.");
            }
        }, 1200);
    });
</script>

</body>
</html>
